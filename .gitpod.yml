# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

tasks:
  - name: Installing all submodules & dependencies
    init: |
      echo 'ðŸ“¦ Installing all dependencies'
      git submodule update --recursive --remote
      yarn
      gp sync-done deps
  ## Ethereum node
  - name: Running local node
    init: |
      echo 'â›“ Waiting for dependencies to finish'
      gp sync-await deps
      echo 'â›“ Starting Ethereum node'
    command: yarn run:local:node --hostname 0.0.0.0
  - name: Deploy smart contracts
    command: |
      echo 'â›“ Waiting for Ethereum node to be deployed'
      gp await-port 8545
      yarn deploy:local:contracts
      echo 'â›“ Ethereum node deployed, triggering subgraph'
      gp sync-done node
    openMode: split-right
  ## Graph node & Subgraph
  - name: Spin up graph node (needs ethereum node)
    init: |
      echo 'ðŸ—‚ Waiting for Ethereum node to be deployed'
      gp sync-await node
      echo 'ðŸ—‚ Ethereum node deployed, starting graph node'
    command: |
      yarn run:local:subgraph
    openMode: tab-after
  - name: Deploy subgraph
    init: gp sync-await graph
    command: |
      echo 'ðŸ—‚ Waiting for graph node (GraphQL server) to start'
      gp await-port 8020
      echo 'ðŸ—‚ Graph node started, deploying for Subgraph'
      yarn config:local:subgraph
      yarn build:local:subgraph
      yarn deploy:local:subgraph
      gp sync-done subgraph
      echo 'ðŸ—‚ Subgraph deploying, starting application'
    openMode: split-right
  ## Application
  - name: Starts dev server (nextjs)
    init: gp sync-await subgraph
    command: |
      echo 'ðŸ¦„ Starting nextjs application '
      yarn run:local:app
    openMode: tab-after
ports:
  - port: 3000
    onOpen: open-preview
vscode:
  extensions:
    - dbaeumer.vscode-eslint

